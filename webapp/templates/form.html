{% extends "header.html" %} {% block content %}
<div id="map"></div>
<div id="mapLoad">Map Loading...</div>
<script>
  let map, popup;
  console.log('pre-position getting');
  navigator.geolocation.getCurrentPosition(map_init);
  console.log('post position getting')
  function map_init(position) {
    console.log('start');
    let lat = position.coords.latitude;
    let long = position.coords.longitude;
    setFormLatLng(lat, long);
    map = L.map("map").setView([lat, long], 13);
    console.log('view set');
    L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution:
        '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    }).addTo(map);
    console.log('tile layer');
    let marker = L.marker([lat, long]).addTo(map);
    popup = L.popup();
    map.on("click", onMapClick);
    document.getElementById('mapLoad').style.display = 'none';
  }

  function onMapClick(e) {
    setFormLatLng(e.latlng.lat, e.latlng.lng);
    popup
      .setLatLng(e.latlng)
      .setContent(
        "Form coordinates set to " + e.latlng.lat + ", " + e.latlng.lng
      )
      .openOn(map);
  }

  function setFormLatLng(lat, lng) {
    document.getElementById('latitude').value = lat;
    document.getElementById('longitude').value = lng;
  }
</script>
<form action="/submit" method="POST">
    <div class="flexme">
        <label for="latitude">Latitude:</label>
        <input type="number" id="latitude" name="latitude" step="any">
        <label for="longitude">Longitude:</label>
        <input type="number" id="longitude" name="longitude" step="any">
    </div>
    <input type="text" name="name">
    <input id="submit" value="Submit" type="submit">
</form>
{% endblock %}
